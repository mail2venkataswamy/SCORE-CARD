/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
/**
 * @param {?} element
 * @param {?} callback
 * @return {?}
 */
export function waitForAnimation(element, callback) {
    if (element === null) {
        return;
    }
    requestAnimationFrame(() => {
        /** @type {?} */
        const computedStyle = window.getComputedStyle(element);
        if (computedStyle.animationName !== 'none' &&
            computedStyle.animationPlayState === 'running') {
            return once(element, 'animationend', callback);
        }
        callback();
    });
}
/**
 * @param {?} element
 * @param {?} eventName
 * @param {?} listener
 * @return {?}
 */
function once(element, eventName, listener) {
    element.addEventListener(eventName, function listenOnce(e) {
        element.removeEventListener(eventName, listenOnce);
        return listener(e);
    });
}
/** @type {?} */
export const closest = typeof Element != 'undefined' && Element.prototype.closest
    ? (el, s) => el.closest(s)
    : function _closest(self, s) {
        /** @type {?} */
        const matches = (((/** @type {?} */ (self))).document || self.ownerDocument).querySelectorAll(s);
        /** @type {?} */
        let i;
        /** @type {?} */
        let el = self;
        do {
            i = matches.length;
            while (--i >= 0 && matches.item(i) !== el) { }
        } while (i < 0 && (el = el.parentElement));
        return el;
    };
/**
 * @param {?} trigger
 * @param {?} dropdown
 * @param {?} __2
 * @return {?}
 */
export function calculatePosition(trigger, dropdown, { horizontalPosition, verticalPosition, matchTriggerWidth, previousHorizontalPosition, previousVerticalPosition }) {
    // Collect information about all the involved DOM elements
    /** @type {?} */
    const scroll = { left: window.pageXOffset, top: window.pageYOffset };
    const { left: triggerLeft, top: triggerTop, width: triggerWidth, height: triggerHeight } = trigger.getBoundingClientRect();
    let { height: dropdownHeight, width: dropdownWidth } = dropdown.getBoundingClientRect();
    /** @type {?} */
    const viewportWidth = window.innerWidth;
    /** @type {?} */
    const style = {};
    // Calculate drop down width
    dropdownWidth = matchTriggerWidth ? triggerWidth : dropdownWidth;
    if (matchTriggerWidth) {
        style.width = dropdownWidth;
    }
    // Calculate horizontal position
    /** @type {?} */
    const triggerLeftWithScroll = triggerLeft + scroll.left;
    if (horizontalPosition === 'auto') {
        // Calculate the number of visible horizontal pixels if we were to place the
        // dropdown on the left and right
        /** @type {?} */
        const leftVisible = Math.min(viewportWidth, triggerLeft + dropdownWidth) -
            Math.max(0, triggerLeft);
        /** @type {?} */
        const rightVisible = Math.min(viewportWidth, triggerLeft + triggerWidth) -
            Math.max(0, triggerLeft + triggerWidth - dropdownWidth);
        if (dropdownWidth > leftVisible && rightVisible > leftVisible) {
            // If the drop down won't fit left-aligned, and there is more space on the
            // right than on the left, then force right-aligned
            horizontalPosition = 'right';
        }
        else if (dropdownWidth > rightVisible && leftVisible > rightVisible) {
            // If the drop down won't fit right-aligned, and there is more space on
            // the left than on the right, then force left-aligned
            horizontalPosition = 'left';
        }
        else {
            // Keep same position as previous
            horizontalPosition = previousHorizontalPosition || 'left';
        }
    }
    if (horizontalPosition === 'right') {
        style.right = viewportWidth - (triggerLeftWithScroll + triggerWidth);
    }
    else if (horizontalPosition === 'center') {
        style.left = triggerLeftWithScroll + (triggerWidth - dropdownWidth) / 2;
    }
    else {
        style.left = triggerLeftWithScroll;
    }
    // Calculate vertical position
    /** @type {?} */
    const triggerTopWithScroll = triggerTop + scroll.top;
    if (verticalPosition === 'above') {
        style.top = triggerTopWithScroll - dropdownHeight;
    }
    else if (verticalPosition === 'below') {
        style.top = triggerTopWithScroll + triggerHeight;
    }
    else {
        /** @type {?} */
        const viewportBottom = scroll.top + self.window.innerHeight;
        /** @type {?} */
        const enoughRoomBelow = triggerTopWithScroll + triggerHeight + dropdownHeight < viewportBottom;
        /** @type {?} */
        const enoughRoomAbove = triggerTop > dropdownHeight;
        if (previousVerticalPosition === 'below' &&
            !enoughRoomBelow &&
            enoughRoomAbove) {
            verticalPosition = 'above';
        }
        else if (previousVerticalPosition === 'above' &&
            !enoughRoomAbove &&
            enoughRoomBelow) {
            verticalPosition = 'below';
        }
        else if (!previousVerticalPosition) {
            verticalPosition = enoughRoomBelow ? 'below' : 'above';
        }
        else {
            verticalPosition = previousVerticalPosition;
        }
        style.top =
            triggerTopWithScroll +
                (verticalPosition === 'below' ? triggerHeight : -dropdownHeight);
    }
    return { horizontalPosition, verticalPosition, style };
}
/**
 * @param {?} trigger
 * @param {?} dropdown
 * @param {?} __2
 * @return {?}
 */
export function calculateInPlacePosition(trigger, dropdown, { horizontalPosition, verticalPosition }) {
    /** @type {?} */
    let dropdownRect;
    /** @type {?} */
    const positionData = {};
    if (horizontalPosition === 'auto') {
        /** @type {?} */
        const triggerRect = trigger.getBoundingClientRect();
        dropdownRect = dropdown.getBoundingClientRect();
        /** @type {?} */
        const viewportRight = window.pageXOffset + window.innerWidth;
        positionData.horizontalPosition =
            triggerRect.left + dropdownRect.width > viewportRight ? 'right' : 'left';
    }
    if (verticalPosition === 'above') {
        positionData.verticalPosition = verticalPosition;
        dropdownRect = dropdownRect || dropdown.getBoundingClientRect();
        positionData.style = { top: -dropdownRect.height };
    }
    return positionData;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLWRyb3Bkb3duLyIsInNvdXJjZXMiOlsibGliL3V0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE1BQU0sMkJBQ0osT0FBdUIsRUFDdkIsUUFBNEI7SUFFNUIsSUFBSSxPQUFPLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE9BQU87S0FDUjtJQUVELHFCQUFxQixDQUFDLEdBQUcsRUFBRTs7Y0FDbkIsYUFBYSxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7UUFFdEQsSUFDRSxhQUFhLENBQUMsYUFBYSxLQUFLLE1BQU07WUFDdEMsYUFBYSxDQUFDLGtCQUFrQixLQUFLLFNBQVMsRUFDOUM7WUFDQSxPQUFPLElBQUksQ0FBQyxPQUFPLEVBQUUsY0FBYyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1NBQ2hEO1FBRUQsUUFBUSxFQUFFLENBQUM7SUFDYixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7Ozs7Ozs7QUFFRCxjQUNFLE9BQWEsRUFDYixTQUFpQixFQUNqQixRQUEyQjtJQUUzQixPQUFPLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLG9CQUFvQixDQUFDO1FBQ3ZELE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFFbkQsT0FBTyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDckIsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDOztBQUVELE1BQU0sT0FBTyxPQUFPLEdBQ2xCLE9BQU8sT0FBTyxJQUFJLFdBQVcsSUFBSSxPQUFPLENBQUMsU0FBUyxDQUFDLE9BQU87SUFDeEQsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDMUIsQ0FBQyxDQUFDLGtCQUFrQixJQUFhLEVBQUUsQ0FBUzs7Y0FDbEMsT0FBTyxHQUFHLENB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LEtBQUssRUFBRSxDQUFDO0FBQ3pELENBQUM7Ozs7Ozs7QUFFRCxNQUFNLG1DQUNKLE9BQWdCLEVBQ2hCLFFBQWlCLEVBQ2pCLEVBQUUsa0JBQWtCLEVBQUUsZ0JBQWdCLEVBQU87O1FBRXpDLFlBQVk7O1VBQ1YsWUFBWSxHQUFRLEVBQUU7SUFFNUIsSUFBSSxrQkFBa0IsS0FBSyxNQUFNLEVBQUU7O2NBQzNCLFdBQVcsR0FBRyxPQUFPLENBQUMscUJBQXFCLEVBQUU7UUFDbkQsWUFBWSxHQUFHLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDOztjQUMxQyxhQUFhLEdBQUcsTUFBTSxDQUFDLFdBQVcsR0FBRyxNQUFNLENBQUMsVUFBVTtRQUM1RCxZQUFZLENBQUMsa0JBQWtCO1lBQzdCLFdBQVcsQ0FBQyxJQUFJLEdBQUcsWUFBWSxDQUFDLEtBQUssR0FBRyxhQUFhLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0tBQzVFO0lBQ0QsSUFBSSxnQkFBZ0IsS0FBSyxPQUFPLEVBQUU7UUFDaEMsWUFBWSxDQUFDLGdCQUFnQixHQUFHLGdCQUFnQixDQUFDO1FBQ2pELFlBQVksR0FBRyxZQUFZLElBQUksUUFBUSxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDaEUsWUFBWSxDQUFDLEtBQUssR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsQ0FBQztLQUNwRDtJQUNELE9BQU8sWUFBWSxDQUFDO0FBQ3RCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZnVuY3Rpb24gd2FpdEZvckFuaW1hdGlvbihcbiAgZWxlbWVudDogRWxlbWVudCB8IG51bGwsXG4gIGNhbGxiYWNrOiAoZT86IEV2ZW50KSA9PiBhbnlcbik6IHZvaWQge1xuICBpZiAoZWxlbWVudCA9PT0gbnVsbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgY29uc3QgY29tcHV0ZWRTdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpO1xuXG4gICAgaWYgKFxuICAgICAgY29tcHV0ZWRTdHlsZS5hbmltYXRpb25OYW1lICE9PSAnbm9uZScgJiZcbiAgICAgIGNvbXB1dGVkU3R5bGUuYW5pbWF0aW9uUGxheVN0YXRlID09PSAncnVubmluZydcbiAgICApIHtcbiAgICAgIHJldHVybiBvbmNlKGVsZW1lbnQsICdhbmltYXRpb25lbmQnLCBjYWxsYmFjayk7XG4gICAgfVxuXG4gICAgY2FsbGJhY2soKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIG9uY2UoXG4gIGVsZW1lbnQ6IE5vZGUsXG4gIGV2ZW50TmFtZTogc3RyaW5nLFxuICBsaXN0ZW5lcjogKGU6IEV2ZW50KSA9PiBhbnlcbik6IHZvaWQge1xuICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jdGlvbiBsaXN0ZW5PbmNlKGUpIHtcbiAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBsaXN0ZW5PbmNlKTtcblxuICAgIHJldHVybiBsaXN0ZW5lcihlKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBjb25zdCBjbG9zZXN0OiAoZWxlbWVudDogRWxlbWVudCwgc2VsZWN0b3I6IHN0cmluZykgPT4gRWxlbWVudCB8IG51bGwgPVxuICB0eXBlb2YgRWxlbWVudCAhPSAndW5kZWZpbmVkJyAmJiBFbGVtZW50LnByb3RvdHlwZS5jbG9zZXN0XG4gICAgPyAoZWwsIHMpID0+IGVsLmNsb3Nlc3QocylcbiAgICA6IGZ1bmN0aW9uIF9jbG9zZXN0KHNlbGY6IEVsZW1lbnQsIHM6IHN0cmluZykge1xuICAgICAgICBjb25zdCBtYXRjaGVzID0gKFxuICAgICAgICAgIChzZWxmIGFzIGFueSkuZG9jdW1lbnQgfHwgc2VsZi5vd25lckRvY3VtZW50XG4gICAgICAgICkucXVlcnlTZWxlY3RvckFsbChzKTtcbiAgICAgICAgbGV0IGk7XG4gICAgICAgIGxldCBlbDogRWxlbWVudCB8IG51bGwgPSBzZWxmO1xuICAgICAgICBkbyB7XG4gICAgICAgICAgaSA9IG1hdGNoZXMubGVuZ3RoO1xuICAgICAgICAgIHdoaWxlICgtLWkgPj0gMCAmJiBtYXRjaGVzLml0ZW0oaSkgIT09IGVsKSB7fVxuICAgICAgICB9IHdoaWxlIChpIDwgMCAmJiAoZWwgPSBlbC5wYXJlbnRFbGVtZW50KSk7XG4gICAgICAgIHJldHVybiBlbDtcbiAgICAgIH07XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVQb3NpdGlvbihcbiAgdHJpZ2dlcjogRWxlbWVudCxcbiAgZHJvcGRvd246IEVsZW1lbnQsXG4gIHtcbiAgICBob3Jpem9udGFsUG9zaXRpb24sXG4gICAgdmVydGljYWxQb3NpdGlvbixcbiAgICBtYXRjaFRyaWdnZXJXaWR0aCxcbiAgICBwcmV2aW91c0hvcml6b250YWxQb3NpdGlvbixcbiAgICBwcmV2aW91c1ZlcnRpY2FsUG9zaXRpb25cbiAgfTogYW55XG4pOiBhbnkge1xuICAvLyBDb2xsZWN0IGluZm9ybWF0aW9uIGFib3V0IGFsbCB0aGUgaW52b2x2ZWQgRE9NIGVsZW1lbnRzXG4gIGNvbnN0IHNjcm9sbCA9IHsgbGVmdDogd2luZG93LnBhZ2VYT2Zmc2V0LCB0b3A6IHdpbmRvdy5wYWdlWU9mZnNldCB9O1xuICBjb25zdCB7XG4gICAgbGVmdDogdHJpZ2dlckxlZnQsXG4gICAgdG9wOiB0cmlnZ2VyVG9wLFxuICAgIHdpZHRoOiB0cmlnZ2VyV2lkdGgsXG4gICAgaGVpZ2h0OiB0cmlnZ2VySGVpZ2h0XG4gIH0gPSB0cmlnZ2VyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICBsZXQge1xuICAgIGhlaWdodDogZHJvcGRvd25IZWlnaHQsXG4gICAgd2lkdGg6IGRyb3Bkb3duV2lkdGhcbiAgfSA9IGRyb3Bkb3duLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICBjb25zdCB2aWV3cG9ydFdpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gIGNvbnN0IHN0eWxlOiBhbnkgPSB7fTtcblxuICAvLyBDYWxjdWxhdGUgZHJvcCBkb3duIHdpZHRoXG4gIGRyb3Bkb3duV2lkdGggPSBtYXRjaFRyaWdnZXJXaWR0aCA/IHRyaWdnZXJXaWR0aCA6IGRyb3Bkb3duV2lkdGg7XG4gIGlmIChtYXRjaFRyaWdnZXJXaWR0aCkge1xuICAgIHN0eWxlLndpZHRoID0gZHJvcGRvd25XaWR0aDtcbiAgfVxuXG4gIC8vIENhbGN1bGF0ZSBob3Jpem9udGFsIHBvc2l0aW9uXG4gIGNvbnN0IHRyaWdnZXJMZWZ0V2l0aFNjcm9sbCA9IHRyaWdnZXJMZWZ0ICsgc2Nyb2xsLmxlZnQ7XG4gIGlmIChob3Jpem9udGFsUG9zaXRpb24gPT09ICdhdXRvJykge1xuICAgIC8vIENhbGN1bGF0ZSB0aGUgbnVtYmVyIG9mIHZpc2libGUgaG9yaXpvbnRhbCBwaXhlbHMgaWYgd2Ugd2VyZSB0byBwbGFjZSB0aGVcbiAgICAvLyBkcm9wZG93biBvbiB0aGUgbGVmdCBhbmQgcmlnaHRcbiAgICBjb25zdCBsZWZ0VmlzaWJsZSA9XG4gICAgICBNYXRoLm1pbih2aWV3cG9ydFdpZHRoLCB0cmlnZ2VyTGVmdCArIGRyb3Bkb3duV2lkdGgpIC1cbiAgICAgIE1hdGgubWF4KDAsIHRyaWdnZXJMZWZ0KTtcbiAgICBjb25zdCByaWdodFZpc2libGUgPVxuICAgICAgTWF0aC5taW4odmlld3BvcnRXaWR0aCwgdHJpZ2dlckxlZnQgKyB0cmlnZ2VyV2lkdGgpIC1cbiAgICAgIE1hdGgubWF4KDAsIHRyaWdnZXJMZWZ0ICsgdHJpZ2dlcldpZHRoIC0gZHJvcGRvd25XaWR0aCk7XG5cbiAgICBpZiAoZHJvcGRvd25XaWR0aCA+IGxlZnRWaXNpYmxlICYmIHJpZ2h0VmlzaWJsZSA+IGxlZnRWaXNpYmxlKSB7XG4gICAgICAvLyBJZiB0aGUgZHJvcCBkb3duIHdvbid0IGZpdCBsZWZ0LWFsaWduZWQsIGFuZCB0aGVyZSBpcyBtb3JlIHNwYWNlIG9uIHRoZVxuICAgICAgLy8gcmlnaHQgdGhhbiBvbiB0aGUgbGVmdCwgdGhlbiBmb3JjZSByaWdodC1hbGlnbmVkXG4gICAgICBob3Jpem9udGFsUG9zaXRpb24gPSAncmlnaHQnO1xuICAgIH0gZWxzZSBpZiAoZHJvcGRvd25XaWR0aCA+IHJpZ2h0VmlzaWJsZSAmJiBsZWZ0VmlzaWJsZSA+IHJpZ2h0VmlzaWJsZSkge1xuICAgICAgLy8gSWYgdGhlIGRyb3AgZG93biB3b24ndCBmaXQgcmlnaHQtYWxpZ25lZCwgYW5kIHRoZXJlIGlzIG1vcmUgc3BhY2Ugb25cbiAgICAgIC8vIHRoZSBsZWZ0IHRoYW4gb24gdGhlIHJpZ2h0LCB0aGVuIGZvcmNlIGxlZnQtYWxpZ25lZFxuICAgICAgaG9yaXpvbnRhbFBvc2l0aW9uID0gJ2xlZnQnO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBLZWVwIHNhbWUgcG9zaXRpb24gYXMgcHJldmlvdXNcbiAgICAgIGhvcml6b250YWxQb3NpdGlvbiA9IHByZXZpb3VzSG9yaXpvbnRhbFBvc2l0aW9uIHx8ICdsZWZ0JztcbiAgICB9XG4gIH1cbiAgaWYgKGhvcml6b250YWxQb3NpdGlvbiA9PT0gJ3JpZ2h0Jykge1xuICAgIHN0eWxlLnJpZ2h0ID0gdmlld3BvcnRXaWR0aCAtICh0cmlnZ2VyTGVmdFdpdGhTY3JvbGwgKyB0cmlnZ2VyV2lkdGgpO1xuICB9IGVsc2UgaWYgKGhvcml6b250YWxQb3NpdGlvbiA9PT0gJ2NlbnRlcicpIHtcbiAgICBzdHlsZS5sZWZ0ID0gdHJpZ2dlckxlZnRXaXRoU2Nyb2xsICsgKHRyaWdnZXJXaWR0aCAtIGRyb3Bkb3duV2lkdGgpIC8gMjtcbiAgfSBlbHNlIHtcbiAgICBzdHlsZS5sZWZ0ID0gdHJpZ2dlckxlZnRXaXRoU2Nyb2xsO1xuICB9XG5cbiAgLy8gQ2FsY3VsYXRlIHZlcnRpY2FsIHBvc2l0aW9uXG4gIGNvbnN0IHRyaWdnZXJUb3BXaXRoU2Nyb2xsID0gdHJpZ2dlclRvcCArIHNjcm9sbC50b3A7XG4gIGlmICh2ZXJ0aWNhbFBvc2l0aW9uID09PSAnYWJvdmUnKSB7XG4gICAgc3R5bGUudG9wID0gdHJpZ2dlclRvcFdpdGhTY3JvbGwgLSBkcm9wZG93bkhlaWdodDtcbiAgfSBlbHNlIGlmICh2ZXJ0aWNhbFBvc2l0aW9uID09PSAnYmVsb3cnKSB7XG4gICAgc3R5bGUudG9wID0gdHJpZ2dlclRvcFdpdGhTY3JvbGwgKyB0cmlnZ2VySGVpZ2h0O1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHZpZXdwb3J0Qm90dG9tID0gc2Nyb2xsLnRvcCArIHNlbGYud2luZG93LmlubmVySGVpZ2h0O1xuICAgIGNvbnN0IGVub3VnaFJvb21CZWxvdyA9XG4gICAgICB0cmlnZ2VyVG9wV2l0aFNjcm9sbCArIHRyaWdnZXJIZWlnaHQgKyBkcm9wZG93bkhlaWdodCA8IHZpZXdwb3J0Qm90dG9tO1xuICAgIGNvbnN0IGVub3VnaFJvb21BYm92ZSA9IHRyaWdnZXJUb3AgPiBkcm9wZG93bkhlaWdodDtcblxuICAgIGlmIChcbiAgICAgIHByZXZpb3VzVmVydGljYWxQb3NpdGlvbiA9PT0gJ2JlbG93JyAmJlxuICAgICAgIWVub3VnaFJvb21CZWxvdyAmJlxuICAgICAgZW5vdWdoUm9vbUFib3ZlXG4gICAgKSB7XG4gICAgICB2ZXJ0aWNhbFBvc2l0aW9uID0gJ2Fib3ZlJztcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgcHJldmlvdXNWZXJ0aWNhbFBvc2l0aW9uID09PSAnYWJvdmUnICYmXG4gICAgICAhZW5vdWdoUm9vbUFib3ZlICYmXG4gICAgICBlbm91Z2hSb29tQmVsb3dcbiAgICApIHtcbiAgICAgIHZlcnRpY2FsUG9zaXRpb24gPSAnYmVsb3cnO1xuICAgIH0gZWxzZSBpZiAoIXByZXZpb3VzVmVydGljYWxQb3NpdGlvbikge1xuICAgICAgdmVydGljYWxQb3NpdGlvbiA9IGVub3VnaFJvb21CZWxvdyA/ICdiZWxvdycgOiAnYWJvdmUnO1xuICAgIH0gZWxzZSB7XG4gICAgICB2ZXJ0aWNhbFBvc2l0aW9uID0gcHJldmlvdXNWZXJ0aWNhbFBvc2l0aW9uO1xuICAgIH1cbiAgICBzdHlsZS50b3AgPVxuICAgICAgdHJpZ2dlclRvcFdpdGhTY3JvbGwgK1xuICAgICAgKHZlcnRpY2FsUG9zaXRpb24gPT09ICdiZWxvdycgPyB0cmlnZ2VySGVpZ2h0IDogLWRyb3Bkb3duSGVpZ2h0KTtcbiAgfVxuXG4gIHJldHVybiB7IGhvcml6b250YWxQb3NpdGlvbiwgdmVydGljYWxQb3NpdGlvbiwgc3R5bGUgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUluUGxhY2VQb3NpdGlvbihcbiAgdHJpZ2dlcjogRWxlbWVudCxcbiAgZHJvcGRvd246IEVsZW1lbnQsXG4gIHsgaG9yaXpvbnRhbFBvc2l0aW9uLCB2ZXJ0aWNhbFBvc2l0aW9uIH06IGFueVxuKSB7XG4gIGxldCBkcm9wZG93blJlY3Q7XG4gIGNvbnN0IHBvc2l0aW9uRGF0YTogYW55ID0ge307XG5cbiAgaWYgKGhvcml6b250YWxQb3NpdGlvbiA9PT0gJ2F1dG8nKSB7XG4gICAgY29uc3QgdHJpZ2dlclJlY3QgPSB0cmlnZ2VyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGRyb3Bkb3duUmVjdCA9IGRyb3Bkb3duLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IHZpZXdwb3J0UmlnaHQgPSB3aW5kb3cucGFnZVhPZmZzZXQgKyB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICBwb3NpdGlvbkRhdGEuaG9yaXpvbnRhbFBvc2l0aW9uID1cbiAgICAgIHRyaWdnZXJSZWN0LmxlZnQgKyBkcm9wZG93blJlY3Qud2lkdGggPiB2aWV3cG9ydFJpZ2h0ID8gJ3JpZ2h0JyA6ICdsZWZ0JztcbiAgfVxuICBpZiAodmVydGljYWxQb3NpdGlvbiA9PT0gJ2Fib3ZlJykge1xuICAgIHBvc2l0aW9uRGF0YS52ZXJ0aWNhbFBvc2l0aW9uID0gdmVydGljYWxQb3NpdGlvbjtcbiAgICBkcm9wZG93blJlY3QgPSBkcm9wZG93blJlY3QgfHwgZHJvcGRvd24uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgcG9zaXRpb25EYXRhLnN0eWxlID0geyB0b3A6IC1kcm9wZG93blJlY3QuaGVpZ2h0IH07XG4gIH1cbiAgcmV0dXJuIHBvc2l0aW9uRGF0YTtcbn1cbiJdfQ==